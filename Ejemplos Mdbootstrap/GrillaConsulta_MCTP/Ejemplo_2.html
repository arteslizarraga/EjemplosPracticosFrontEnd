<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Planificaci&oacute;n y Dise&ntilde;o de Programas</title>
    <link rel="shortcut icon" href="https://www.inacap.cl/web/template-aplicaciones/img/favicon.ico" />
    <link rel="stylesheet" href="https://www.inacap.cl/web/template-aplicaciones/css/mdb.min.css" />
    <style>
        /* Galería Imágenes */

        .galeria-ordenada td img{
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .galeria-ordenada td.tiene-contenido {
            width: 120px;
            height: 120px;
        }

        .galeria-ordenada td {
            vertical-align: top;   /* Alinear contenido arriba */
        }

        .galeria-ordenada td p {
            word-break: break-word; 
            cursor: pointer;
            margin: 1em;
        }

    </style>
</head>

<body id="appBody" class="d-flex flex-column">
    <div class="page-content">
        <div class="navbar-overlay"></div>

        <main id="main" class="container">
            <section>

                <div class="card" id="buscar">

                    <div class="card-header">
                        <h4 class="float-left heading h4-responsive mb-0">Ejemplo 2</h4>
                    </div>
                    <div class="card-body">

                        <div class="row">
                            <div class="col-12">
                            
                                <table id="table-tfl" border="2">
                                    <thead>
                                      <tr>
                                        <th></th>
                                        <th>Nivel 1</th>
                                        <th>Nivel 2</th>
                                        <th>Nivel 3</th>
                                        <th>Nivel 4</th>
                                        <th>Nivel 5</th>
                                      </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>

                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div id="tabla-desplegada"></div>
                            </div>
                        </div>

                        <br/><br/>

                    </div>

                    <div class="card-footer">

                        <div class="row">

                            <div class="col-12 d-flex justify-content-end">

                                <button type="button" class="btn btn-secondary waves-effect waves-light">
                                    <span>Opción 1</span>
                                </button>
                                <button type="button" class="btn btn-default waves-effect waves-light">
                                    <span>Opción 1</span>
                                </button>
                            </div>

                        </div>

                    </div>
                </div>
            </section>
        </main>
    </div>

    <footer class="page-footer">
        <div class="container py-3">
            <div class="d-flex align-items-center justify-content-center justify-content-md-start">
                <div class="logo-gst"><img src="http://www.inacap.cl/web/template-aplicaciones/img/logo-gst.png"
                        alt="" /></div>
                <span class="pl-2 pl-md-4">Gerencia de Sistemas y Tecnolog&iacute;as</span>
            </div>
        </div>
    </footer>

    <script src="https://www.inacap.cl/web/template-aplicaciones/js/jquery-3.3.1.min.js"></script>
    <script src="https://www.inacap.cl/web/template-aplicaciones/js/popper.min.js"></script>
    <script src="https://www.inacap.cl/web/template-aplicaciones/js/bootstrap.min.js"></script>
    <script src="https://www.inacap.cl/web/template-aplicaciones/js/mdb.min.js"></script>
    <script src="https://www.inacap.cl/web/template-aplicaciones/js/chosen.jquery.js"></script>
    <script src="https://www.inacap.cl/web/template-aplicaciones/js/datepicker.js"></script>
    <script src="https://www.inacap.cl/web/template-aplicaciones/js/datatables.min.js"></script>

    <script>

        $("body").tooltip({ selector: "[data-toggle=tooltip]", trigger: "hover" });  // Habilitar tooltips

        let textoGrande = `Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. AAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA`;

        let arregloRutas = [
            {
                nombreRuta: "Ruta 1",
                infoNiveles: [
                    {
                        numeroNivel: 1,
                        elementos: [
                            { correlativo: 1, texto: "Probar con Este", asociadoCon: [2] },
                            { correlativo: 2, texto: "Relacionado", asociadoCon: [1, 3] },
                            { correlativo: 2, texto: textoGrande, asociadoCon: [] },
                            { correlativo: 2, texto: "Rellenar", asociadoCon: [] },
                            { correlativo: 2, texto: textoGrande, asociadoCon: [] }
                        ]
                    },
                    {
                        numeroNivel: 2,
                        elementos: [
                            { correlativo: 3, texto: "Texto Nivel 2", asociadoCon: [2] },
                            { correlativo: 4, texto: "Texto", asociadoCon: [2] },
                            { correlativo: 2, texto: textoGrande, asociadoCon: [] },
                        ]
                    },
                    {
                        numeroNivel: 3,
                        elementos: [
                            { correlativo: 5, texto: "Relacionado", asociadoCon: [1] },
                            { correlativo: 6, texto: "Texto", asociadoCon: [4] }
                        ]
                    },
                    {
                        numeroNivel: 4,
                        elementos: [
                            { correlativo: 7, texto: "Texto", asociadoCon: [6] },
                            { correlativo: 8, texto: "Texto", asociadoCon: [9] }
                        ]
                    },
                    {
                        numeroNivel: 5,
                        elementos: [
                            { correlativo: 9, texto: "Texto", asociadoCon: [5] },
                            { correlativo: 10, texto: "Texto", asociadoCon: [8] }
                        ]
                    }
                ]
            }
        ];

        let cadenaProbando = "";

        arregloRutas.forEach(ruta => 
        {
            cadenaProbando += `<tr valign="top">`;

            cadenaProbando += `
            <td class="ruta p-2">
                <div class="card title h-100 align-items-center justify-content-center">
                    <div>${ruta.nombreRuta}</div>
                </div>
            </td>
            `;

            ruta.infoNiveles.forEach(infoNivel => 
            {
                console.log(infoNivel);  //  { numeroNivel: 1, elementos: (5) […] }

                cadenaProbando += `<td>`;
                    cadenaProbando += babushka(infoNivel.elementos);

                    /*
                    cadenaProbando += `<div class="card-container d-flex flex-row flex-wrap justify-content-between">`;
                    
                    // console.log(`   numeroNivel: ${infoNivel.numeroNivel}`);

                    infoNivel.elementos.forEach(x => 
                    {
                        let clasesCssAsociacion = x.asociadoCon.map(x => `me-asocio-con-${x}`).join(" ");

                        //============================>>>

                        let textoDesplegado = x.texto;
                        let infoTooltip = "";

                        if (textoDesplegado.length > 20) {
                            textoDesplegado = `${textoDesplegado.slice(0, 70)} ...`;
                            infoTooltip = `data-toggle="tooltip" data-placement="top" title="${x.texto}"`;
                        }

                        //============================>>>

                        cadenaProbando += `
                        <div class="col-6 p-0">
                            <div class="card sm cards-ruta m-1 text-center ${clasesCssAsociacion}" id="${x.correlativo}">
                            <p ${infoTooltip}>${textoDesplegado}</p>
                            <div class="d-flex justify-content-between section-action">
                                <a><i class="material-icons icon-lg" data-toggle="tooltip" data-placement="top" title="Ver perfiles">person</i></a>
                                <a data-toggle="modal" data-target="#ModalDetalle"><i class="material-icons icon-lg blue-text" data-toggle="tooltip" data-placement="top" title="Ver detalle">visibility</i></a>
                            </div>
                            </div>
                        </div>
                        `;

                    });

                    cadenaProbando += `</div>`;
                    */
                cadenaProbando += `</td>`;
            });

            cadenaProbando += `</tr>`;
        });

        document.querySelector("#table-tfl tbody").innerHTML = cadenaProbando; 

        
        function babushka(listaFotos) 
        {
            let cantidadColumnas = 2;
            let cantidadFilas = Math.round(listaFotos.length / cantidadColumnas);  // Calcula la cantidad de filas que tendrá la tabla
            
            //=============================================================================================>>>>>>
            // Llenar la galería
            
            let matriz = [];
            let arrRangoFilas = Array.from(Array(cantidadFilas).keys());          // [ 0, 1, 2 ]
            let arrRangoColumnas = Array.from(Array(cantidadColumnas).keys());    // [ 0, 1, 2 ]
            let cont = 0;

            arrRangoFilas.forEach(fila => 
            {
                matriz.push([]);

                arrRangoColumnas.forEach(columna => 
                {
                    if (listaFotos[cont] != null && matriz[fila] != null)  // Si existe la posición en el arreglo
                        matriz[fila][columna] = listaFotos[cont];  
                    else 
                        matriz[fila][columna] = { correlativo: 0, src: null };  // Agrega un item vacío para rellenar

                    cont ++;
                });
            });

            //=============================================================================================>>>>>>

            let cadena = `
            <table class="galeria-ordenada">

                ${matriz.map(fila => 
                { 
                    return `
                    <tr>
                        ${fila.map(celda => 
                        { 
                            let estiloBordeTd = "none";
                            let claseTd = "";
                            let contenidoTd = "";

                            if (celda.correlativo != 0)  // Si es cero, es porque es una celda (td) para rellenar, pero que no existe
                            {
                                estiloBordeTd = "2px solid";
                                claseTd = "tiene-contenido";

                                let textoDesplegado = celda.texto;
                                let infoTooltip = "";
                
                                if (textoDesplegado.length > 40) {
                                    textoDesplegado = `${textoDesplegado.slice(0, 40)} ...`;
                                    infoTooltip = `data-toggle="tooltip" data-placement="top" title="${celda.texto}"`;
                                }

                                contenidoTd = `<p ${infoTooltip}> ${textoDesplegado} </p>`;
                            }

                            return `
                            <td style="border: ${estiloBordeTd}" class="${claseTd}"> 
                                ${contenidoTd}
                            </td>
                            `;

                        }).join("")} 
                    </tr>
                    `;

                }).join("")} 
            </table>
            `;

            return cadena;
        }


    </script>
</body>

</html>