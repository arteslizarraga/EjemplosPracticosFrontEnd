<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cards completar Pasos</title>
  <link rel="shortcut icon" href="https://www.inacap.cl/web/template-aplicaciones/img/favicon.ico" />
  <link rel="stylesheet" href="https://www.inacap.cl/web/template-aplicaciones/css/mdb.min.css">
  
  <style>
    
    #detalle-progreso .card{
      min-height: 375px;
    }

    #detalle-progreso .card .card-body{
      font-size: .875rem;
    }

    #detalle-progreso .card .card-footer button{
      border: none;
      background-color: transparent;
      color: #1565C0;
      padding: 0;
      cursor: pointer;
      min-height: 50px;
    }

    #detalle-progreso .card .card-footer button:disabled{
      color: #ccc;
    }

    #detalle-progreso .card .card-footer{
      position: absolute;
      bottom: 0;
      margin: 0 auto;
      left: 0;
      right: 0;
    }

    .btn-separator:after {
      content: '';
      position: absolute;
      background-color: #ccc;
      width: 1px;
      height: 100%;
      right: 0;
    }

  </style>

</head>

<body id="appBody" class="d-flex flex-column">

  <div class="page-content">

    <div class="navbar-overlay"></div>

    <header class="header">

      <div class="header-container">

        <!--Logo-->
        <div class="header-logo">
          <a href="https://www.inacap.cl">
            <img src="https://www.inacap.cl/web/template-aplicaciones/img/isotipo.png" alt="INACAP" class="logo-mobile">
            <img src="https://www.inacap.cl/web/template-aplicaciones/img/logo-inacap.png" alt="INACAP" class="logo">
          </a>
        </div>

        <!--Titulo, recuerda que tambien debes reemplazar el nombre en el script m&aacute;s abajo-->
        <div class="header-title">
          <h1 id="title">Sistema de definición de Programas Formativos: Módulo Diseño MCTP</h1>
        </div>

        <!--Datos del Usuario-->
        <div class="user-info">

          <!--Nombre-->
          <div class="user-name mr-4">
            <p>Nombre Colaborador</p>
          </div>


          <!-- Iconos encabezado - Mobile -->
          <div class="user-mobile-menu user-button dropdown dropdown-toggle" role="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            <i class="material-icons">more_vert</i>

            <div class="dropdown-menu dropdown-menu-right">
              <p class="dropdown-user-name">Colaborador X</p>
              <p class="dropdown-title dropdown-title--border">Accesibilidad</p>
              <ul class="accesibility-menu">
                <li class="accesibility-menu__item">
                  <div class="d-flex align-items-center justify-content-between" onclick="darkMode();">
                    <span class="tipo-de-modo">Modo Oscuro</span>
                    <div class="d-flex justify-content-center">
                      <span>
                        <i class="material-icons"> brightness_medium</i>
                      </span>
                    </div>
                  </div>
                </li>
                <li class="accesibility-menu__item">
                  <div class="d-flex align-items-center justify-content-between">
                    <span>Tamaño de letra</span>
                    <div class="d-flex justify-content-center">
                      <span tabindex="0" role="button"
                        class="btnDecrease btn btn-round btn-fonts btn-secondary d-flex align-items-center justify-content-center waves-effect waves-light">
                        <i class="material-icons">remove</i>
                      </span>
                      <span tabindex="0" role="button"
                        class="btnEnlarge btn btn-round btn-fonts btn-default d-flex align-items-center justify-content-center ml-2 mr-0 waves-effect waves-light">
                        <i class="material-icons">add</i>
                      </span>
                    </div>
                  </div>
                </li>
              </ul>

              <!--- Cerrar Sesi&oacute;n-->
              <p class="dropdown-title dropdown-title--border">Cuenta</p>
              <ul class="accesibility-menu">
                <li class="accesibility-menu__item">
                  <div class="d-flex align-items-center justify-content-between">
                    <span id="tipo-de-modo">Cerrar Sesión</span>
                    <div class="d-flex justify-content-center">
                      <span>
                        <i class="material-icons">exit_to_app</i>
                      </span>
                    </div>
                  </div>
                </li>
              </ul>

            </div>

          </div>
          <!-- Iconos encabezado - Mobile -->

          <!-- Iconos encabezado - Escritorio-->
          <div class="user-desktop-icons">

            <div class="user-accesibility user-button dropdown dropdown-toggle" role="button" data-toggle="dropdown"
              aria-haspopup="true" aria-expanded="false">

              <i class="material-icons ">accessibility</i>

              <div class="dropdown-menu dropdown-menu-right">
                <p class="dropdown-title">Accesibilidad</p>
                <ul class="accesibility-menu">
                  <li class="accesibility-menu__item">
                    <div class="d-flex align-items-center justify-content-between" onclick="darkMode();">
                      <span class="tipo-de-modo">Modo Oscuro</span>
                      <div class="d-flex justify-content-center">
                        <span>
                          <i class="material-icons"> brightness_medium</i>
                        </span>
                      </div>
                    </div>
                  </li>
                  <li class="accesibility-menu__item">
                    <div class="d-flex align-items-center justify-content-between">
                      <span>Tamaño de letra</span>
                      <div class="d-flex justify-content-center">
                        <span tabindex="0" role="button"
                          class="btnDecrease btn btn-round btn-fonts btn-secondary d-flex align-items-center justify-content-center waves-effect waves-light"><i
                            class="material-icons">remove</i></span>
                        <span tabindex="0" role="button"
                          class="btnEnlarge btn btn-round btn-fonts btn-default d-flex align-items-center justify-content-center ml-2 mr-0 waves-effect waves-light"><i
                            class="material-icons">add</i></span>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>

            </div>

            <div class="user-logout user-button">
              <a href="#"><i class="material-icons">exit_to_app</i></a>
            </div>

          </div>
          <!-- Iconos encabezado - Escritorio-->

        </div>
      </div>

    </header>

    <nav class="navbar toggle-navbar-lg">
      <div class="container">
        <button class="d-lg-none d-flex align-items-center pl-0" id="toggle-navbar" aria-label="Ver Menu"
          onclick="openNav()">
          <i class="material-icons icon-lg mr-1">menu</i>
          <span>Menu</span>
        </button>

        <ul id="offCanvas" class="nav navbar-nav navbar-offcanvas navbar-expand-lg justify-content-start">
          <a href="javascript:void(0)" class="d-lg-none closebtn waves-effect waves-light" onclick="closeNav()">
            <span role="button" class="material-icons">
              close
            </span>
          </a>
          <li class="nav-item">
            <a href="../../index.html" class="nav-link waves-effect active">Menú Operacional</a>
          </li>
        </ul>
      </div>
    </nav>

    <main id="main" class="container">

      <section class="row breadcrumb">

        <span class="breadcrumb-item">Menú Operacional</span>
        <span class="breadcrumb-item">Buscar Asignaturas</span>

        <span class="breadcrumb-item">Resultado de búsqueda</span><span class="breadcrumb-item">Matematica Aplicada
          I</span><span class="breadcrumb-item active">Detalle Progreso para Oficializar</span>
      </section>

      <section class="d-flex justify-content-center flex-column align-items-center">

        <div class="card col-12 no-card" id="detalle-progreso" style="display: block;">
          <div class="card-header">
            <div class="row">
              <div class="col-12">
                <h4 class="float-left heading h4-responsive mb-0">Evidencias para Oficialización de Asignaturas | <span
                    id="detalle-progreso-nombre-asignatura">Nombre Asignatura</span></h4>
              </div>
            </div>
          </div>

          <div class="card-body">
            <div id="despliegue-cards" class="row mb-4"></div>
          </div>

          <div class="card-footer">

            <div class="row mb-4">

              <div class="col-12 d-flex justify-content-between">

                <button id="btn-volver-resultados" class="btn btn-outline waves-effect waves-light">
                  <span>Volver</span>
                </button>

                <button id="btn-enviar-oficializar" class="btn btn-default waves-effect waves-light" disabled="">
                  <span>Enviar a Oficializar</span>
                </button>

              </div>

            </div>
          </div>

        </div>

      </section>
    </main>

  </div>


  <footer class="page-footer">
    <div class="container py-3">
      <div class="d-flex align-items-center justify-content-center justify-content-md-start">
        <div class="logo-gst"><img src="http://www.inacap.cl/web/template-aplicaciones/img/logo-gst.png" alt=""></div>
        <span class="pl-2 pl-md-4">Gerencia de Sistemas y Tecnologías</span>
      </div>
    </div>
  </footer>


  <!-- Loading Overlay -->
  <div class="loading-backdrop" id="loadingOverlay" style="display: none;">
    <div class="loading-circle">
      <div class="preloader-wrapper big active">
        <div class="spinner-layer spinner-white-only">
          <div class="circle-clipper left">
            <div class="circle"></div>
          </div>
          <div class="gap-patch">
            <div class="circle"></div>
          </div>
          <div class="circle-clipper right">
            <div class="circle"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="ModalValidar" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-notify modal-warning" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <p class="heading lead">Validar Paso</p>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">

            <div class="col-md-12">
              <p class="text-center"><i class="material-icons icon-3x mb-3 animated rotateIn">warning</i></p>
              <p class="text-center m-0">
                Una vez validado el paso no podrá volver atrás en el proceso.
                ¿Está seguro de que quiere realizar esta acción?
              </p>
            </div>

          </div>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn mx-2 btn-secondary waves-effect waves-light" data-dismiss="modal">No,
            cancelar</button>
          <button onclick="validarPaso()" type="button"
            class="btn  mx-2 btn-default waves-effect waves-light alerta">Sí, validar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="https://www.inacap.cl/web/template-aplicaciones/js/jquery-3.3.1.min.js"></script>
  <!-- Bootstrap tooltips -->
  <script src="https://www.inacap.cl/web/template-aplicaciones/js/popper.min.js"></script>
  <!-- Bootstrap core JavaScript -->
  <script src="https://www.inacap.cl/web/template-aplicaciones/js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script src="https://www.inacap.cl/web/template-aplicaciones/js/mdb.min.js"></script>
  <div class="hiddendiv common"></div>

  <script src="http://www.inacap.cl/web/template-aplicaciones/js/chosen.jquery.js"></script>

  <script src="http://www.inacap.cl/web/template-aplicaciones/js/datatables.min.js"></script>

  <script src="https://www.inacap.cl/web/template-aplicaciones/js/datepicker.js"></script>

  <script>
  
  this.paso = 0;
  this.arregloCards = [];

  (async () => 
  {
    this.arregloCards = await obtenerArregloCards();
    desplegarCards();
  })();

  function irCompletarChecklist() { 
    //window.open("completar_checklist.html", "_blank");
    this.arregloCards.find(x => x.paso == 5).haCargadoDatos = true;
    desplegarCards();
  }

  function irCompletarLvc() { 
    //window.open("definir_lvc_curricular.html", "_blank");
    this.arregloCards.find(x => x.paso == 2).haCargadoDatos = true;
    desplegarCards();
  }

  function cargarEvidencia() {
    this.arregloCards.find(x => x.paso == 3).haCargadoDatos = true;
    desplegarCards();
  }

  function abrirModalValidarPaso(paso) {
    this.paso = paso;
    $("#ModalValidar").modal("show"); 
  }

  function validarPaso() 
  {
    let card = this.arregloCards.find(x => x.paso == this.paso);
    card.estaCompleto = true;
    console.log(card);

    if (this.paso == 2) 
      this.arregloCards.find(x => x.paso == 3).habilitadoIngresoDatos = true;   // Habilita el paso 3

    if (this.paso == 3) 
      this.arregloCards.find(x => x.paso == 5).habilitadoIngresoDatos = true;   // Habilita el paso 5
    
    $("#ModalValidar").modal("hide"); 
    desplegarCards();
  }

  function desplegarCards() 
  {
    let cadena = `
    <div id="despliegue-cards" class="row mb-4">

      ${this.arregloCards.map(x => 
      {
        return `
        <div class="col">
          <div id="card-1" class="card">
            <div class="card-header">
              <div class="row">
                <div class="col-12 d-flex align-items-start justify-content-start">
                  <i class="material-icons icon-2x mr-2 ${x.estaCompleto ? "success-text" : ""}">${x.estaCompleto ? "check_circle" : "schedule"}</i>
                  <h6 class="h6-responsive font-weight-bold mb-0 ">${x.header.titulo}</h6>
                </div>
              </div>
            </div>
            <div class="card-body">

              ${x.body.parrafos.map(y => 
              {
                return `<p class="${y.class}">${y.contenido}</p>`;
              }).join("")}
            </div>

            <div class="card-footer ${x.footer != null ? 'border-top' : ''}">

                ${(x.footer != null) ? 
                  `<div class="row justify-content-between py-2 mx-0">

                    ${(x.estaCompleto) ? 
                      `<div class="col-6 mx-auto text-center">
                        <button type="button">Ver LVC</button>
                      </div>` 
                      : 
                      x.footer.botones.map((y, i) => 
                      {
                        return `<div class="col-6 text-center ${i == 0 ? "btn-separator" : ""}">
                          <button type="button" onclick="${y.onclick}"
                          ${((i == 0 &&!x.habilitadoIngresoDatos) || (i == 1 && !x.haCargadoDatos)) ? "disabled" : ""}>${y.texto}</button>
                        </div>`;
                      }).join("")
                    }

                  </div>` 
                  : 
                  ""}

            </div>
          </div>
        </div>
        `;
      }).join("")}

    </div>
    `;

    document.querySelector("#despliegue-cards").innerHTML = cadena;
  }

  function obtenerArregloCards()
  {
    return new Promise((resolve, reject) => 
    {
      let retorno = [
        {
          paso: 1,
          estaCompleto: true,
          habilitadoIngresoDatos: true,
          haCargadoDatos: false,
          header: { titulo: "100% Campos Completados" },
          body: {
            parrafos: [
              { contenido: "Se completaron todos los campos requeridos en el desarrollo de la asignatura.", class: "" },
              { contenido: "(Este campo se valida de manera automática cuando se completen los campos requeridos)", class: "font-italic" }
            ]
          },
          footer: null
        },
        {
          paso: 2,
          estaCompleto: false,
          habilitadoIngresoDatos: true,
          haCargadoDatos: false,
          header: { titulo: "LVC - Asesor Curricular" },
          body: {
            parrafos: [
              { contenido: "Una vez que el 100% de los campos estén completados, el Asesor Curricular debe completar la LVC y luego validar el paso.", class: "" }
            ]
          },
          footer: {
            botones: [
              { texto: "Completar <br>LVC", onclick: "irCompletarLvc()" },

              //{ texto: "Validar Paso", onclick: () => this.abrirModalValidarPaso(2) }
              { texto: "Validar Paso", onclick: "abrirModalValidarPaso(2)" }
            ]
          }
        },
        {
          paso: 3,
          estaCompleto: false,
          habilitadoIngresoDatos: false,
          haCargadoDatos: false,
          header: { titulo: "Retroalimentación de Sedes - Comité Técnico" },
          body: {
            parrafos: [
              { contenido: "El Asesor de Área debe solicitar la retroalimentación de Sede y del Comité Técnico cuando corresponda. Luego, debe cargar esa evidencia y validar el paso.", class: "" }
            ]
          },
          footer: {
            botones: [
              { texto: "Cargar Evidencia", onclick: "cargarEvidencia()" },
              { texto: "Validar Paso", onclick: "abrirModalValidarPaso(3)" }
            ]
          }
        },
        {
          paso: 4,
          estaCompleto: true,
          habilitadoIngresoDatos: true,
          haCargadoDatos: false,
          header: { titulo: "Validación Bibliografía" },
          body: {
            parrafos: [
              { contenido: "(Este campo se valida de manera automática una vez que la bibliografía sea evaluada y validada.)", class: "font-italic" }
            ]
          }
        },
        {
          paso: 5,
          estaCompleto: false,
          habilitadoIngresoDatos: false,
          haCargadoDatos: false,
          header: { titulo: "Checklist Final - Director de Área" },
          body: {
            parrafos: [
              { contenido: "Este paso se debe realizar una vez que esté completos los anteriores. El Director de Área debe completar el Checklist y validar el paso.", class: "" },
              { contenido: "(Una vez calidado el paso, se activará la opción de enviar a oficializar la asignatura).", class: "font-italic" }
            ]
          },
          footer: {
            botones: [
              { texto: "Completar Checklist", onclick: "irCompletarChecklist()" },
              { texto: "Validar Paso", onclick: "abrirModalValidarPaso(5)" }
            ]
          }
        }
      ];

      resolve(retorno);
    });
    
  }

  </script>

</html>